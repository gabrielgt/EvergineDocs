<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Create Effects | Evergine Doc </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Create Effects | Evergine Doc ">
    <meta name="generator" content="docfx 2.58.4.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="create-effects">Create Effects</h1>

<hr>
<p><img src="images/effects.jpg" alt="Effect header"></p>
<p>An <strong>effect</strong> is a <em>uber-shader</em> so be able to represent a single shader or a large group of shaders. There are two type of effect in Evergine:</p>
<br> 
<table>
<thead>
<tr>
<th>Effect type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Graphics Effect</td>
<td>Defines a rasterization pipeline Vertex Shader, Geometry Shader, Hull Shader, Domain shader, Pixel Shader and are useful to create materials.</td>
</tr>
<tr>
<td>Compute Effect</td>
<td>Defines a compute pipeline with Compute Shader and are useful to create <a href="">compute task</a> and <a href="../postprocessing_graph/index.html">post-processing graph</a> nodes.</td>
</tr>
</tbody>
</table>
<h2 id="create-a-effect-asset-in-evergine-studio">Create a Effect asset in Evergine Studio</h2>
<p>You can create an effect click button on <img src="../images/plusIcon.jpg" alt="Plus Icon"> from <a href="../../evergine_studio/interface.html">Assets Details</a> panel to deploy a create menu options and click on the option <em>&quot;Create effect-&gt;Graphics Effect or Compute Effect&quot;</em></p>
<p><img src="images/AssetsDetailsMenu.jpg" alt="Create new effect menu option"></p>
<h3 id="inspect-effects-in-asset-details">Inspect effects in Asset Details</h3>
<p>You can find the effect assets in the <a href="../../evergine_studio/interface.html"><strong>Assets Details</strong></a> panel when you select a folder in the <a href="../../evergine_studio/interface.html"><strong>Project Explorer</strong></a>.</p>
<p><img src="images/effectAsset.jpg" alt="Effect asset"></p>
<h3 id="effects-files-in-content-directory">Effects files in content directory</h3>
<p>The effect file has the <code>.wefx</code> extension and always comes together with a folder with the same name of the effect. This folder contains the source code:</p>
<p><img src="images/effectFile.jpg" alt="Effect file"></p>
<h2 id="effect-source-code-example">Effect source code example</h2>
<p>While Effects in Evergine uses HLSL as shading language, it is empowered by using differents <a href="effect_metatags.html">Metatags</a> to automatize some tasks and help users.</p>
<p>A tipical effect code looks like this:</p>
<pre><code class="lang-csharp">[Begin_ResourceLayout]

    [Directives:UseTexture TEX_OFF TEX]

    cbuffer PerDrawCall : register(b0)
    {
        float4x4 WorldViewProj    : packoffset(c0);    [WorldViewProjection]
    };

    cbuffer Parameters : register(b1)
    {
        float3 Color            : packoffset(c0);   [Default(1, 1, 1)]
    };
    
    Texture2D ColorTexture       : register(t0);
    SamplerState ColorSampler    : register(s0);

[End_ResourceLayout]

[Begin_Pass:Default]
    [Profile 10_0]
    [Entrypoints VS=VertexShaderCode PS=PixelShaderCode]

    struct VS_IN
    {
        float4 Position : POSITION;
        #if TEX
        float2 TexCoord : TEXCOORD;
        #endif
    };

    struct PS_IN
    {
        float4 Pos : SV_POSITION;
        #if TEX
        float2 Tex : TEXCOORD;
        #endif
    };

    PS_IN VertexShaderCode(VS_IN input)
    {
        PS_IN output = (PS_IN)0;

        output.Pos = mul(input.Position, WorldViewProj);
        
        #if TEX
        output.Tex = input.TexCoord;
        #endif

        return output;
    }

    float4 PixelShaderCode(PS_IN input) : SV_Target
    {
        float4 color = float4(Color,1);
        
        #if TEX
        color *= ColorTexture.Sample(ColorSampler, input.Tex);
        #endif
        
        return color;
    }

[End_Pass]
</code></pre>
<p>An effect file in Evergine is divided into the following sections:</p>
<ul>
<li>Resource Layout definition</li>
<li>List of Passes</li>
</ul>
<h3 id="resource-layout-definition">Resource Layout definition</h3>
<p>This block of code defines all resources (Constant Buffers, Structured Buffers, Textures and Samplers) that will be used into your shaders.
This section is enclosed between <code>[Begin_ResourceLayout]</code> and <code>[End_ResourceLayout]</code> tags.</p>
<pre><code class="lang-csharp">[Begin_ResourceLayout]

    [Directives:UseTexture TEX_OFF TEX]

    cbuffer PerDrawCall : register(b0)
    {
        float4x4 WorldViewProj    : packoffset(c0);    [WorldViewProjection]
    };

    cbuffer Parameters : register(b1)
    {
        float3 Color            : packoffset(c0);   [Default(1, 1, 1)]
    };
    
    Texture2D ColorTexture        : register(t0);
    SamplerState ColorSampler    : register(s0);

[End_ResourceLayout]
</code></pre>
<p>In this example, :</p>
<ul>
<li><code>[Directives:UseTexture TEX_OFF TEX]</code>:  This section contains a <strong>Directive</strong> (Called <code>UseTexture</code> in this example), which allows the users to enable different features in your effect.
<ul>
<li>This directive specifies two macros (<code>TEX_OFF</code> and <code>TEX</code>) which indicates if this shader will use a color texture or not. In your effect code you are free to define any number of directives as you can. The tradeof is that the number of possible effect combinations rise exponentially in proportion of the number of directives.</li>
<li>You can enable or disable features using macros into your shader with the <code>#if</code> <code>#else</code> and <code>#endif</code> preprocessor directives.</li>
</ul>
</li>
<li>The definition of two constant buffers, a Texture2D and a SamplerState:
<ul>
<li><code>cbuffer PerDrawCall : register(b0) { ... }</code>: A constant buffer.</li>
<li><code>cbuffer Parameters : register(b1) { ... }</code>: A second constant buffer.</li>
<li><code>Texture2D ColorTexture : register(t0);</code>: A texture 2D.</li>
<li><code>SamplerState ColorSampler : register(s0);</code>: A Sampler state.</li>
</ul>
</li>
<li>You would notice that you can add metatags to your constant buffers attributes to specify default values or to inject useful engine parameters. In the example we are using:
<ul>
<li>The <code>[WorldViewProjection]</code> to inject the object world view projection matrix.</li>
<li>The <code>[Default(1, 1, 1)]</code>, which indicate the default value of the <code>Color</code> attribute (white color in this example).</li>
</ul>
</li>
</ul>
<p>The majority of topics mentioned here is detailed in <a href="effect_metatags.html">Effect Metatags</a> document.</p>
<h3 id="list-of-passes">List of Passes</h3>
<p>After the Resource Layout block, your code will specify a list of Passes, each Pass is defined using the <code>[Begin_Pass]</code> and <code>[End_Pass]</code> tags. Each pass requires a name, which will be used by the render path. As a naming convention, all render paths in Evergine must support the <code>Default</code> pass name.</p>
<p>In the previous effect example, a Default pass is defined:</p>
<pre><code class="lang-csharp">[Begin_Pass:Default]
    [Profile 10_0]
    [Entrypoints VS=VertexShaderCode PS=PixelShaderCode]

    struct VS_IN
    {
        float4 Position : POSITION;
        #if TEX
        float2 TexCoord : TEXCOORD;
        #endif
    };

    struct PS_IN
    {
        float4 Pos : SV_POSITION;
        #if TEX
        float2 Tex : TEXCOORD;
        #endif
    };

    PS_IN VertexShaderCode(VS_IN input)
    {
        PS_IN output = (PS_IN)0;

        output.Pos = mul(input.Position, WorldViewProj);
        
        #if TEX
        output.Tex = input.TexCoord;
        #endif

        return output;
    }

    float4 PixelShaderCode(PS_IN input) : SV_Target
    {
        float4 color = float4(Color,1);
        
        #if TEX
        color *= ColorTexture.Sample(ColorSampler, input.Tex);
        #endif
        
        return color;
    }

[End_Pass]
</code></pre>
<p>In this pass, you will find:</p>
<ul>
<li>The <code>[Entrypoints VS=... PS=...]</code> tag, wich defines the entry point per each render pipeline stage. In the example, you are indicating that this pass will use the following entry points:
<ul>
<li><code>VS=VertexShaderCode</code>: During the <strong>Vertex Shader</strong> stage, the VertexShaderCode function will be executed.</li>
<li><code>PS=PixelShaderCode</code>: During the <strong>Pixel Shader</strong> stage, the PixelShaderCode function will be executed.</li>
</ul>
</li>
<li>Hereafter, a typical HLSL shader code is written. You are free to define structures, functions and uses all resources defined inside Resource Layout section.</li>
</ul>
<p>As we mentioned earlier, visit <a href="effect_metatags.html">Effect Metatags</a> for more information.</p>
<h2 id="create-a-new-effect-from-code">Create a new Effect from code</h2>
<p>The following sample code can be used to create a new effect and its associated material to apply to an entity in your scene.</p>
<pre><code class="lang-csharp">protected override void CreateScene()
{
    protected override void CreateScene()
        {
            var graphicsContext = Application.Current.Container.Resolve&lt;GraphicsContext&gt;();
            var assetsService = Application.Current.Container.Resolve&lt;AssetsService&gt;();

            string shaderSource = @&quot;
                [Begin_ResourceLayout]

                    cbuffer PerDrawCall : register(b0)
                    {
                        float4x4 WorldViewProj    : packoffset(c0);    [WorldViewProjection]
                    };

                    cbuffer Parameters : register(b1)
                    {
                        float3 Color            : packoffset(c0);   [Default(1.0, 0.0, 0.0)]
                    };

                [End_ResourceLayout]

                [Begin_Pass:Default]
                    [Profile 10_0]
                    [Entrypoints VS=VS PS=PS]

                    struct VS_IN
                    {
                        float4 Position : POSITION;
                        float3 Normal    : NORMAL;
                        float2 TexCoord : TEXCOORD;
                    };

                    struct PS_IN
                    {
                        float4 pos : SV_POSITION;
                        float3 Nor    : NORMAL;
                        float2 Tex : TEXCOORD;
                    };

                    PS_IN VS(VS_IN input)
                    {
                        PS_IN output = (PS_IN)0;

                        output.pos = mul(input.Position, WorldViewProj);
                        output.Nor = input.Normal;
                        output.Tex = input.TexCoord;

                        return output;
                    }

                    float4 PS(PS_IN input) : SV_Target
                    {
                        return float4(Color,1);
                    }

                [End_Pass]
            &quot;;

            // Create effect
            Effect myEffect = new EffectFromCode(graphicsContext, shaderSource);

            // Create material asociated
            Material myMaterial = new Material(myEffect)
            {
                LayerDescription = assetsService.Load&lt;RenderLayerDescription&gt;(EvergineContent.RenderLayers.Opaque),
            };

            // Apply to an entity
            Entity primitive = new Entity()
                    .AddComponent(new Transform3D())
                    .AddComponent(new MaterialComponent() { Material = myMaterial })
                    .AddComponent(new SphereMesh())
                    .AddComponent(new MeshRenderer());

            this.Managers.EntityManager.Add(primitive);
        }
}
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
          
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <h5>In This Article</h5>
              <div></div>
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <div class="pull-left">
              
              <span>Generated by <strong>DocFX</strong></span>
            </div>      
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
